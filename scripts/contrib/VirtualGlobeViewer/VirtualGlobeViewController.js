define(["backbone.marionette","app","communicator","globals","./VirtualGlobeView"],function(a,b,c,d,e){"use strict";var f=a.Controller.extend({initialize:function(a){this.id=a.id,this.startPosition=a.startPosition,this.position={center:[74,15],distance:1e7,duration:1e3,tilt:45},this.globeView=a.startPosition?new e({startPosition:a.startPosition}):new e({startPosition:this.position}),this.setLayersFromAppContext(),this.connectToView(),this.baseSetupDone=!1},setLayersFromAppContext:function(){d.baseLayers.each(function(a){a.get("visible")&&(this.globeView.addInitialLayer(a,!0),console.log('[VirtualGlobeViewController::setLayersFromAppContext] added baselayer "'+a.get("name")+'"'))}.bind(this)),d.products.each(function(a){a.get("visible")&&(this.globeView.addInitialLayer(a,!1),console.log('[VirtualGlobeViewController::setLayersFromAppContext] added products "'+a.get("name")+'"'))}.bind(this)),d.overlays.each(function(a){a.get("visible")&&(this.globeView.addInitialLayer(a,!1),console.log('[VirtualGlobeViewController::setLayersFromAppContext] added overlays "'+a.get("name")+'"'))}.bind(this))},connectToView:function(){this.listenTo(c.mediator,"selection:changed",this.addAreaOfInterest),this.listenTo(c.mediator,"map:setUrl",this.zoomTo),this.listenTo(c.mediator,"map:center",this.onMapCenter),this.listenTo(c.mediator,"map:layer:change",this.onLayerChange),this.listenTo(c.mediator,"time:change",this.onTimeChange),this.listenTo(c.mediator,"productCollection:updateOpacity",this.onOpacityChange),this.listenTo(c.mediator,"productCollection:sortUpdated",this.onSortChange)},getView:function(){return this.globeView},show:function(){this.region.show(this.globeView)},getLayerModel:function(a){var b=void 0;if(a.isBaseLayer?b=d.baseLayers.find(function(b){return b.get("name")===a.name}):(b=d.products.find(function(b){return b.get("name")===a.name}),b||(b=d.overlays.find(function(b){return b.get("name")===a.name}))),"undefined"==typeof b)throw Error("Product "+a.name+" is unknown!");return b},onSortChange:function(){this.globeView.sortOverlayLayers()},onLayerChange:function(a){var b=this.getLayerModel(a);this.globeView.onLayerChange(b,a.isBaseLayer,a.visible)},onOpacityChange:function(a){this.globeView.onOpacityChange(a.model.get("name"),a.value)},onTimeChange:function(){this.globeView.removeAllOverlays(),this.setLayersFromAppContext(),this.globeView.initLayers()},addAreaOfInterest:function(a){this.globeView.addAreaOfInterest(a)},zoomTo:function(a){var b={center:[a.x,a.y],distance:1e7,duration:1e3,tilt:45};this.globeView.zoomTo(b)},onMapCenter:function(a){var b=0;switch(a.l){case 0:b=5e7;break;case 1:b=3e7;break;case 2:b=18e6;break;case 3:b=9e6;break;case 4:b=48e5;break;case 5:b=24e5;break;case 6:b=12e5;break;case 7:b=7e5;break;case 8:b=3e5;break;case 9:b=8e4;break;case 10:b=3e4;break;case 11:b=9e3;break;case 12:b=7e3;break;case 13:b=5e3;break;case 14:b=4e3}var c={center:[a.x,a.y],distance:b,duration:100,tilt:45};this.globeView.zoomTo(c)},getStartPosition:function(){return this.startPosition},isActive:function(){return!this.globeView.isClosed},dumpLayerConfig:function(){this.globeView.dumpLayerConfig()}});return f});