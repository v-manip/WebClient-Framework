(function(){"use strict";var a=this;a.define(["backbone","globals","regions/DialogRegion","regions/UIRegion","layouts/LayerControlLayout","layouts/ToolControlLayout","core/SplitView/WindowView","communicator","jquery","backbone.marionette","controller/ContentController","controller/DownloadController","controller/SelectionManagerController","controller/LoadingController"],function(a,b,c,d,e,f,g,h){var i=a.Marionette.Application.extend({initialize:function(){},configure:function(a){var d={},g={},h={};_.each(a.regions,function(a){var b={};b[a.name]="#"+a.name,this.addRegions(b)},this),_.each(a.views,function(a){var b=require(a);$.extend(d,b)},this),_.each(a.models,function(a){var b=require(a);$.extend(g,b)},this),_.each(a.templates,function(a){var b=require(a.template);h[a.id]=b},this),b.objects.add("mapmodel",new g.MapModel({visualizationLibs:a.mapConfig.visualizationLibs,center:a.mapConfig.center,zoom:a.mapConfig.zoom})),_.each(a.mapConfig.baseLayers,function(a){b.baseLayers.add(new g.LayerModel({name:a.name,visible:a.visible,view:{id:a.id,urls:a.urls,protocol:a.protocol,projection:a.projection,attribution:a.attribution,matrixSet:a.matrixSet,style:a.style,format:a.format,resolutions:a.resolutions,maxExtent:a.maxExtent,gutter:a.gutter,buffer:a.buffer,units:a.units,transitionEffect:a.transitionEffect,isphericalMercator:a.isphericalMercator,isBaseLayer:!0,wrapDateLine:a.wrapDateLine,zoomOffset:a.zoomOffset}})),console.log("Added baselayer "+a.id)},this);var i=0;if(_.each(a.mapConfig.products,function(a){b.products.add(new g.LayerModel({name:a.name,visible:a.visible,ordinal:i,timeSlider:a.timeSlider,color:a.color,opacity:1,view:{id:a.view.id,protocol:a.view.protocol,urls:a.view.urls,visualization:a.view.visualization,projection:a.view.projection,attribution:a.view.attribution,matrixSet:a.view.matrixSet,style:a.view.style,format:a.view.format,resolutions:a.view.resolutions,maxExtent:a.view.maxExtent,gutter:a.view.gutter,buffer:a.view.buffer,units:a.view.units,transitionEffect:a.view.transitionEffect,isphericalMercator:a.view.isphericalMercator,isBaseLayer:!1,wrapDateLine:a.view.wrapDateLine,zoomOffset:a.view.zoomOffset},download:{id:a.download.id,protocol:a.download.protocol,url:a.download.url}})),console.log("Added product "+a.view.id)},this),_.each(a.mapConfig.overlays,function(a){b.overlays.add(new g.LayerModel({name:a.name,visible:a.visible,ordinal:i,view:{id:a.id,urls:a.urls,protocol:a.protocol,projection:a.projection,attribution:a.attribution,matrixSet:a.matrixSet,style:a.style,format:a.format,resolutions:a.resolutions,maxExtent:a.maxExtent,gutter:a.gutter,buffer:a.buffer,units:a.units,transitionEffect:a.transitionEffect,isphericalMercator:a.isphericalMercator,isBaseLayer:!1,wrapDateLine:a.wrapDateLine,zoomOffset:a.zoomOffset}})),console.log("Added overlay "+a.id)},this),a.navBarConfig){var j=new g.NavBarCollection;_.each(a.navBarConfig.items,function(a){j.add(new g.NavBarItemModel({name:a.name,icon:a.icon,eventToRaise:a.eventToRaise}))},this),this.topBar.show(new d.NavBarCollectionView({template:h.NavBar({title:a.navBarConfig.title,url:a.navBarConfig.url}),className:"navbar navbar-inverse navbar-fixed-top not-selectable",itemView:d.NavBarItemView,tag:"div",collection:j}))}this.addRegions({dialogRegion:c.extend({el:"#viewContent"})}),this.DialogContentView=new d.ContentView({template:{type:"handlebars",template:h.Info},id:"about",className:"modal fade",attributes:{role:"dialog",tabindex:"-1","aria-labelledby":"about-title","aria-hidden":!0,"data-keyboard":!0,"data-backdrop":"static"}}),this.baseLayerView=new d.BaseLayerSelectionView({collection:b.baseLayers,itemView:d.LayerItemView.extend({template:{type:"handlebars",template:h.BulletLayer},className:"radio"})}),this.productsView=new d.LayerSelectionView({collection:b.products,itemView:d.LayerItemView.extend({template:{type:"handlebars",template:h.CheckBoxLayer},className:"sortable-layer"}),className:"sortable"}),this.overlaysView=new d.BaseLayerSelectionView({collection:b.overlays,itemView:d.LayerItemView.extend({template:{type:"handlebars",template:h.CheckBoxOverlayLayer},className:"checkbox"}),className:"check"}),this.layout=new e;var k=new g.ToolCollection;_.each(a.selectionTools,function(a){k.add(new g.ToolModel({id:a.id,description:a.description,icon:a.icon,enabled:!0,active:!1,type:"selection"}))},this);var l=new g.ToolCollection;_.each(a.visualizationTools,function(a){l.add(new g.ToolModel({id:a.id,eventToRaise:a.eventToRaise,description:a.description,icon:a.icon,enabled:a.enabled,active:a.active,type:"tool"}))},this);var m=new g.ToolCollection;_.each(a.visualizationModes,function(a){m.add(new g.ToolModel({id:a.id,eventToRaise:a.eventToRaise,description:a.description,icon:a.icon,enabled:a.enabled,active:a.active,type:"vis_mode"}))},this),this.visualizationToolsView=new d.ToolSelectionView({collection:l,itemView:d.ToolItemView.extend({template:{type:"handlebars",template:h.ToolIcon}})}),this.selectionToolsView=new d.ToolSelectionView({collection:k,itemView:d.ToolItemView.extend({template:{type:"handlebars",template:h.ToolIcon}})}),this.visualizationModesView=new d.ToolSelectionView({collection:m,itemView:d.ToolItemView.extend({template:{type:"handlebars",template:h.ToolIcon}})}),this.toolLayout=new f,this.timeSliderView=new d.TimeSliderView(a.timeSlider)},setupGui:function(){this.module("SplitView").start();var a=this.module("SplitView").createController();this.main.show(a.getView()),a.setSinglescreen(),this.bottomBar.show(this.timeSliderView),$(document).ajaxStart(function(){h.mediator.trigger("progress:change",!0)}),$(document).ajaxStop(function(){h.mediator.trigger("progress:change",!1)}),$(document).ajaxError(function(a,b,c){$("#error-messages").append('<div class="alert alert-warning alert-danger"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button><strong>Warning!</strong> Error response on HTTP '+c.type+" to "+c.url.split("?")[0]+"</div>")}),$("#loadscreen").remove()}});return new i})}).call(this);